# game_platform

-----
### 项目名称
- 游戏对战平台

-----
### 项目描述
- 利用tcp/ip协议、udp协议实现网络游戏对战，简单的通信，用户信息的增、改、查

-----
### 项目实现
- 协议（h.type）说明：
1. 1001：注册协议
2. 1002：登录协议
3. 1004：世界聊天
4. 1005：游戏协议
5. 1006：查询协议
6. 1007：查看所有在线用户协议
7. 1008：心跳包协议
8. 1009：加分协议

-----		
#### 服务器端
0. 创建所有用户信息链表，创建在线用户信息链表（包含玩家信息、套接字、ip地址、端口号、游戏状态）
1. 创建套接字、绑定、监听
2. 开启心跳检测线程；
3. 创建一个efd（epoll_creat），添加监听套接字sfd并添加监听事件EPOLLIN到efd中（epoll_ctl）
4. 创建一个循环，epoll_wait来检测监听套接字事件,当有新的事件发生时,遍历时间结构体数组：

- 如果是监听套接字sfd(evs[i].data.fd)发生变化，则是有新客户端请求链接，接收新的客户端链接,添加新的套接字cfd、ip、端口号、协议族到在	     线链表   中,并将存放到添加到efd中监听事件
- 如果是cfd有可读事件，从事件结构体数组中找到该事件的cfd（evs[i]），根据报头处理信息
5. 信息处理：

+ 注册事件：需判断账户名是否存在，若存在重新注册
+ 登录事件：判断账号密码是否正确，登录成功后将该id加入到在线链表中
+ 世界聊天：收取客户端信息，遍历在线链表并发送给所有玩家
+ 查找用户：j需检查喻户是否存在
+ 获取在线玩家信息：遍历在线l链表、并发送给请求客户端
+ 游戏：匹配玩家、交互双方信息（套接字、ip地址、端口号、玩家信息）
+ 加分事件：给获胜的玩家加分、并保存
+ 心跳事件：接受客户端发送的心跳包，并用状态量来记录
6. 心跳检测

- 每隔一定时间判断玩家状态量，如果不为0，置零；如果为0，说明玩家掉线
- 如果玩家跳线，玩家若在普通状态，从efd中移除该客户端套接字；玩家若在游戏中，将发送消息到另一名玩家的客户端，告知其进行托管
   

-----
#### 客户端
1. 创建tcp套接字，绑定、链接
   创建udp套接字，绑定
   
2. 开辟线程定时向服务器发送心跳包

3. 进入主菜单选项：

- 登录/注册
4. 进入二级菜单：

- 世界聊天：向服务器发送1004协议告诉服务器进入到世界聊天状态
- 查找玩家：输入要查找的id，向服务器发送1006协议，向服务其申请该id信息
- 查看在线玩家：向服务器发送1007协议，申请获取所有在线玩家
- 注销

5. 进入游戏界面

- 向服务器发送游戏协议1005
- 匹配玩家，等待服务器开始游戏的信号
- 根据服务器发来的另一名玩家信息，创建ud链接
- 开始游戏，epoll监听tcp、udp套接字事件
- 如果玩家掉线，收到服务器发来的信息，开始托管
- 游戏结束时，获得胜利的客户端将向服务器发送获胜协议














